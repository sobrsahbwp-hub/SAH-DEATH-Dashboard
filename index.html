<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sadiq Abbasi Hospital - Mortality Dashboard</title>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{
    font-family:'Segoe UI',sans-serif;
    margin:0;
    background:#f4f8fc;
}
.top-bar{
    display:flex;
    justify-content:flex-end;
    padding:10px 20px;
    background:#fff;
    box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
.clock{
    font-weight:bold;
    color:#007BFF;
}
header{
    text-align:center;
    background:white;
    padding:15px;
}
.logo{height:80px;}

.filters{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:15px;
    padding:20px;
}
select,input{
    width:100%;
    padding:6px;
    border-radius:6px;
    border:1px solid #ccc;
}

.kpis{
    display:flex;
    justify-content:center;
    gap:20px;
    flex-wrap:wrap;
}
.kpi{
    background:white;
    padding:20px;
    border-radius:10px;
    box-shadow:0 3px 8px rgba(0,0,0,0.1);
    text-align:center;
    width:220px;
}
.chart-wrapper{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:30px;
    padding:20px;
}
.chart-box{
    background:white;
    padding:20px;
    border-radius:10px;
    box-shadow:0 3px 8px rgba(0,0,0,0.1);
    width:480px;
}
footer{
    text-align:center;
    padding:10px;
    background:#fff;
}
</style>
</head>
<body>

<div class="top-bar">
<div class="clock" id="clock"></div>
</div>

<header>
<img src="https://drive.google.com/uc?export=view&id=1Y5PbMKEFDgSk9CiSZOAdVyxRyAse6hXU" class="logo">
<h2>SADIQ ABBASI HOSPITAL, BAHAWALPUR</h2>
<h3>Hospital Mortality Dashboard</h3>
</header>

<div class="filters">
<div><label>From Date</label><input type="date" id="fromDate"></div>
<div><label>To Date</label><input type="date" id="toDate"></div>
<div><label>Department</label><select id="department"><option value="">All</option></select></div>
<div><label>District</label><select id="district"><option value="">All</option></select></div>
<div><label>Diagnosis</label><select id="diagnosis"><option value="">All</option></select></div>
<div><label>Gender</label><select id="gender"><option value="">All</option></select></div>
</div>

<div class="kpis">
<div class="kpi">
<h4>Total Deaths</h4>
<h2 id="totalDeaths">0</h2>
</div>
<div class="kpi">
<h4>Total Male Deaths</h4>
<h2 id="maleDeaths">0</h2>
</div>
<div class="kpi">
<h4>Total Female Deaths</h4>
<h2 id="femaleDeaths">0</h2>
</div>
</div>

<div class="chart-wrapper">
<div class="chart-box">
<h4>Department Wise Deaths</h4>
<canvas id="deptChart"></canvas>
</div>

<div class="chart-box">
<h4>District Wise Distribution</h4>
<canvas id="districtChart"></canvas>
</div>
</div>

<footer>
Developed By: Software Engineer MUHAMMAD UMAIR SYED
</footer>

<script>

const sheetURL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQz914IFr1jBOBuiujol-M_LYK9qLBtaHeAsQtqW8xvJqyZxwRee5yRIK6wHj4HrISYzCE5LxucL59C/pub?gid=801410960&single=true&output=csv";

let rawData=[];
let deptChart,districtChart;

/* CLOCK */
function updateClock(){
const now=new Date();
document.getElementById("clock").innerHTML=
now.toLocaleDateString()+" | "+now.toLocaleTimeString();
}
setInterval(updateClock,1000);
updateClock();

/* LOAD CSV */
Papa.parse(sheetURL,{
download:true,
header:true,
skipEmptyLines:true,
complete:function(results){

rawData = results.data.map(r=>({
DATE: r["DATE"] ? new Date(r["DATE"]) : null,
GENDER: (r["GENDER"]||"").trim().toLowerCase(),
DEPARTMENT: (r["DEPARTMENT"]||"").trim(),
DIAGNOSIS: (r["DIAGNOSIS"]||"").trim(),
DISTRICT: (r["DISTRICT"]||"").trim()
}));

populateFilters();
applyFilters();
}
});

/* Populate Dropdowns */
function populateSelect(key,id){
const select=document.getElementById(id);
const values=[...new Set(rawData.map(d=>d[key]).filter(v=>v))].sort();
values.forEach(v=>{
select.innerHTML+=`<option value="${v}">${v}</option>`;
});
}

function populateFilters(){
populateSelect("DEPARTMENT","department");
populateSelect("DISTRICT","district");
populateSelect("DIAGNOSIS","diagnosis");
populateSelect("GENDER","gender");
}

/* Filter Listener */
document.querySelectorAll("select,input").forEach(el=>{
el.addEventListener("change",applyFilters);
});

/* Filtering Logic */
function applyFilters(){

const from=document.getElementById("fromDate").value;
const to=document.getElementById("toDate").value;
const dept=document.getElementById("department").value;
const dist=document.getElementById("district").value;
const diag=document.getElementById("diagnosis").value;
const gen=document.getElementById("gender").value;

let filtered=rawData.filter(d=>{

let dateMatch=true;
if(from && d.DATE) dateMatch = d.DATE >= new Date(from);
if(to && d.DATE) dateMatch = dateMatch && d.DATE <= new Date(to);

return dateMatch &&
(!dept || d.DEPARTMENT===dept) &&
(!dist || d.DISTRICT===dist) &&
(!diag || d.DIAGNOSIS===diag) &&
(!gen || d.GENDER===gen);
});

/* KPI Updates */
document.getElementById("totalDeaths").innerText=filtered.length;
document.getElementById("maleDeaths").innerText=
filtered.filter(d=>d.GENDER==="male").length;
document.getElementById("femaleDeaths").innerText=
filtered.filter(d=>d.GENDER==="female").length;

/* Grouping */
let deptGroup={}, districtGroup={};

filtered.forEach(d=>{
if(d.DEPARTMENT)
deptGroup[d.DEPARTMENT]=(deptGroup[d.DEPARTMENT]||0)+1;

if(d.DISTRICT)
districtGroup[d.DISTRICT]=(districtGroup[d.DISTRICT]||0)+1;
});

renderCharts(deptGroup,districtGroup);
}

/* Chart Colors */
function generateColors(count){
return Array.from({length:count},(_,i)=>`hsl(${i*45},70%,55%)`);
}

/* Render Charts */
function renderCharts(deptGroup,districtGroup){

if(deptChart) deptChart.destroy();
if(districtChart) districtChart.destroy();

deptChart=new Chart(document.getElementById("deptChart"),{
type:"bar",
data:{
labels:Object.keys(deptGroup),
datasets:[{
data:Object.values(deptGroup),
backgroundColor:generateColors(Object.keys(deptGroup).length)
}]
},
options:{
responsive:true,
plugins:{legend:{display:false}},
scales:{y:{beginAtZero:true}}
}
});

districtChart=new Chart(document.getElementById("districtChart"),{
type:"pie",
data:{
labels:Object.keys(districtGroup),
datasets:[{
data:Object.values(districtGroup),
backgroundColor:generateColors(Object.keys(districtGroup).length)
}]
},
options:{
responsive:true,
plugins:{legend:{position:"bottom"}}
}
});
}

</script>
</body>
</html>
