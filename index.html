<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sadiq Abbasi Hospital Dashboard</title>

<style>
body {
    font-family: 'Segoe UI', sans-serif;
    background: #f4f8fb;
    margin: 0;
}

.header {
    text-align: center;
    padding: 20px;
    background: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.header h1 {
    margin: 5px;
    font-size: 28px;
    color: #0a4fa3;
    letter-spacing: 2px;
}

.header h3 {
    margin: 0;
    font-weight: 400;
    color: #555;
}

.container {
    padding: 30px;
}

.filters {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    margin-bottom: 30px;
}

select, input {
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
}

button {
    background: #0a4fa3;
    color: white;
    border: none;
    padding: 9px 18px;
    border-radius: 6px;
    cursor: pointer;
}

button:hover {
    background: #083a7a;
}

.kpi-card {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    text-align: center;
    width: 300px;
}

.kpi-title {
    font-size: 16px;
    color: #777;
}

.kpi-value {
    font-size: 42px;
    font-weight: bold;
    color: #c62828;
    margin-top: 10px;
}
</style>
</head>

<body>

<div class="header">
    <h1>SADIQ ABBASI HOSPITAL</h1>
    <h3>Bahawalpur</h3>
</div>

<div class="container">

<div class="filters">
    <label>From:
        <input type="date" id="fromDate">
    </label>

    <label>To:
        <input type="date" id="toDate">
    </label>

    <label>District:
        <select id="districtDropdown">
            <option value="">All Districts</option>
        </select>
    </label>

    <label>Ward:
        <select id="wardDropdown">
            <option value="">All Wards</option>
            <option>GYNAE WARD</option>
            <option>PEADS WARD</option>
            <option>PEADS EMERGENCY WARD</option>
            <option>NICU EMERGENCY</option>
            <option>NURSERY (OUT-BORN) WARD</option>
            <option>PICU WARD</option>
            <option>NICU (IN-BORN) WARD</option>
            <option>SURGICAL WARD</option>
            <option>ORTHO WARD</option>
            <option>MEDICAL WARD</option>
            <option>PULMONOLOGY WARD</option>
            <option>MEDICAL/SURGICAL ICU WARD</option>
            <option>PRIVATE ROOM</option>
            <option>ENT WARD</option>
            <option>EYE WARD</option>
            <option>EMERGENCY WARD</option>
            <option>DENGUE WARD</option>
        </select>
    </label>

    <button onclick="applyFilters()">Apply</button>
</div>

<div class="kpi-card">
    <div class="kpi-title">TOTAL DEATHS</div>
    <div class="kpi-value" id="totalDeaths">0</div>
</div>

</div>

<script>

const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQz914IFr1jBOBuiujol-M_LYK9qLBtaHeAsQtqW8xvJqyZxwRee5yRIK6wHj4HrISYzCE5LxucL59C/pub?gid=801410960&single=true&output=csv";

let sheetData = [];

fetch(sheetURL)
.then(response => response.text())
.then(csv => {
    const rows = csv.split("\n").map(r => r.split(","));
    const headers = rows[0];

    sheetData = rows.slice(1).map(row => {
        let obj = {};
        headers.forEach((h, i) => obj[h.trim()] = row[i]);
        return obj;
    });

    populateDistricts();
});

function populateDistricts() {
    const districts = [...new Set(sheetData.map(r => r["District"]).filter(Boolean))];
    const dropdown = document.getElementById("districtDropdown");

    districts.forEach(d => {
        const option = document.createElement("option");
        option.value = d;
        option.textContent = d;
        dropdown.appendChild(option);
    });
}

function applyFilters() {
    const fromDate = document.getElementById("fromDate").value;
    const toDate = document.getElementById("toDate").value;
    const district = document.getElementById("districtDropdown").value;
    const ward = document.getElementById("wardDropdown").value;

    let filtered = sheetData;

    if (fromDate) {
        filtered = filtered.filter(r => new Date(r["Date"]) >= new Date(fromDate));
    }

    if (toDate) {
        filtered = filtered.filter(r => new Date(r["Date"]) <= new Date(toDate));
    }

    if (district) {
        filtered = filtered.filter(r => r["District"] === district);
    }

    if (ward) {
        filtered = filtered.filter(r => r["Ward"] === ward);
    }

    const totalDeaths = filtered.filter(r => 
        r["Death"] && r["Death"].toString().toLowerCase() === "yes"
    ).length;

    document.getElementById("totalDeaths").textContent = totalDeaths;
}

</script>

</body>
</html>
