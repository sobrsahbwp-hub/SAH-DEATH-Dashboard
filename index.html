<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hospital Mortality Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
font-family:Segoe UI, sans-serif;
background:#f4f8fc;
margin:0;
padding:20px;
}

.header{
text-align:center;
margin-bottom:20px;
}

.logo{
height:90px;
}

h1{color:#003366;margin:10px 0 5px;}
h3{color:#555;margin-top:0;}

.filters{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
gap:15px;
margin-bottom:25px;
}

.filter-box{
display:flex;
flex-direction:column;
}

label{
font-weight:600;
margin-bottom:5px;
}

select,input{
padding:8px;
border-radius:6px;
border:1px solid #ccc;
}

.kpi-container{
display:flex;
flex-wrap:wrap;
justify-content:center;
gap:20px;
margin-bottom:30px;
}

.kpi{
background:#ffffff;
padding:20px;
border-radius:12px;
box-shadow:0 4px 10px rgba(0,0,0,0.08);
min-width:200px;
text-align:center;
}

.kpi h2{
margin:0;
color:#003366;
font-size:28px;
}

.chart-container{
max-width:800px;
margin:auto;
background:white;
padding:20px;
border-radius:12px;
box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

.buttons{
display:flex;
justify-content:space-between;
margin-top:25px;
}

button{
padding:10px 20px;
border:none;
border-radius:8px;
background:#003366;
color:white;
cursor:pointer;
}

.footer{
margin-top:40px;
text-align:center;
font-size:14px;
color:#444;
}

@media print{
body{background:white;}
button{display:none;}
}
</style>
</head>

<body>

<div id="dashboard">

<div class="header">
<img class="logo"
src="https://drive.google.com/uc?export=view&id=1Y5PbMKEFDgSk9CiSZOAdVyxRyAse6hXU">
<h1>SADIQ ABBASI HOSPITAL, BAHAWALPUR</h1>
<h3>Hospital Mortality Dashboard</h3>
</div>

<div class="filters">

<div class="filter-box">
<label>From Date</label>
<input type="date" id="fromDate">
</div>

<div class="filter-box">
<label>To Date</label>
<input type="date" id="toDate">
</div>

<div class="filter-box">
<label>District</label>
<select id="district"></select>
</div>

<div class="filter-box">
<label>Ward</label>
<select id="ward">
<option>ALL WARDS</option>
<option>GYNAE WARD</option>
<option>PEADS WARD</option>
<option>PEADS EMERGENCY WARD</option>
<option>NICU EMERGENCY</option>
<option>NURSERY (OUT-BORN) WARD</option>
<option>PICU WARD</option>
<option>NICU (IN-BORN) WARD</option>
<option>SURGICAL WARD</option>
<option>ORTHO WARD</option>
<option>MEDICAL WARD</option>
<option>PULMONOLOGY WARD</option>
<option>MEDICAL/SURGICAL ICU WARD</option>
<option>PRIVATE ROOM</option>
<option>ENT WARD</option>
<option>EYE WARD</option>
<option>EMERGENCY WARD</option>
<option>DENGUE WARD</option>
</select>
</div>

<div class="filter-box">
<label>Gender</label>
<select id="gender">
<option>ALL GENDERS</option>
<option>MALE</option>
<option>FEMALE</option>
<option>TRANSGENDER</option>
</select>
</div>

<div class="filter-box">
<label>Age Group</label>
<select id="ageGroup">
<option>ALL</option>
<option>Below 30 Days</option>
<option>1 Month to 1 Year</option>
<option>1 Year to 15 Years</option>
<option>15 to 30 Years</option>
<option>30 Years to 45 Years</option>
<option>45 Years to 60 Years</option>
<option>65 Years & above</option>
</select>
</div>

</div>

<div class="kpi-container">
<div class="kpi">
<h2 id="total">0</h2>
Total Deaths
</div>

<div class="kpi">
<h2 id="male">0</h2>
Male Deaths
</div>

<div class="kpi">
<h2 id="female">0</h2>
Female Deaths
</div>
</div>

<div class="chart-container">
<canvas id="deptChart"></canvas>
</div>

<div class="buttons">
<button onclick="exportPDF()">Export to PDF</button>
<button onclick="location.reload()">Refresh</button>
</div>

<div class="footer">
Developed By:
<a href="https://www.linkedin.com/in/smus79" target="_blank">
Software Engineer MUHAMMAD UMAIR SYED
</a>
(IT Officer, Sadiq Abbasi Hospital, Bahawalpur)
</div>

</div>

<script>

const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQz914IFr1jBOBuiujol-M_LYK9qLBtaHeAsQtqW8xvJqyZxwRee5yRIK6wHj4HrISYzCE5LxucL59C/pub?gid=801410960&single=true&output=csv";

let rawData=[];
let chart;

fetch(csvUrl)
.then(res=>res.text())
.then(text=>{
const rows=text.trim().split("\n").map(r=>r.split(","));
const headers=rows[0];

rawData=rows.slice(1).map(r=>{
let obj={};
headers.forEach((h,i)=>obj[h.trim()]=r[i]);
return obj;
});

populateDistrict();
applyFilters();
});

function populateDistrict(){
const select=document.getElementById("district");
select.innerHTML="<option>ALL DISTRICTS</option>";
const districts=[...new Set(rawData.map(r=>r["District"]))].filter(Boolean);
districts.forEach(d=>{
let opt=document.createElement("option");
opt.text=d;
select.add(opt);
});
}

document.querySelectorAll("select,input")
.forEach(el=>el.addEventListener("change",applyFilters));

function ageFilter(age,group){
age=parseFloat(age);
if(!age) return false;

switch(group){
case "Below 30 Days": return age<0.1;
case "1 Month to 1 Year": return age>=0.1 && age<1;
case "1 Year to 15 Years": return age>=1 && age<=15;
case "15 to 30 Years": return age>15 && age<=30;
case "30 Years to 45 Years": return age>30 && age<=45;
case "45 Years to 60 Years": return age>45 && age<=60;
case "65 Years & above": return age>=65;
default:return true;
}
}

function applyFilters(){

let from=document.getElementById("fromDate").value;
let to=document.getElementById("toDate").value;
let district=document.getElementById("district").value;
let ward=document.getElementById("ward").value;
let gender=document.getElementById("gender").value;
let ageGroup=document.getElementById("ageGroup").value;

let filtered=rawData.filter(r=>{

let date=r["Date"];
if(from && date<from) return false;
if(to && date>to) return false;
if(district!="ALL DISTRICTS" && r["District"]!=district) return false;
if(ward!="ALL WARDS" && r["Ward"]!=ward) return false;
if(gender!="ALL GENDERS" && r["Gender"]!=gender) return false;
if(ageGroup!="ALL" && !ageFilter(r["Age"],ageGroup)) return false;

return true;
});

document.getElementById("total").innerText=filtered.length;
document.getElementById("male").innerText=
filtered.filter(r=>r["Gender"]=="MALE").length;
document.getElementById("female").innerText=
filtered.filter(r=>r["Gender"]=="FEMALE").length;

let deptCounts={};
filtered.forEach(r=>{
let d=r["Department"];
deptCounts[d]=(deptCounts[d]||0)+1;
});

drawChart(deptCounts);
}

function drawChart(dataObj){

if(chart) chart.destroy();

chart=new Chart(document.getElementById("deptChart"),{
type:"bar",
data:{
labels:Object.keys(dataObj),
datasets:[{
label:"Deaths",
data:Object.values(dataObj),
backgroundColor:[
"#003366","#006699","#0099cc","#00cccc",
"#33cccc","#66cccc","#ff6666","#ff9966",
"#ffcc66","#cc6699","#6699ff"
]
}]
},
options:{
responsive:true,
plugins:{legend:{display:false}},
scales:{y:{beginAtZero:true}}
}
});
}

function exportPDF(){
html2canvas(document.querySelector("#dashboard")).then(canvas=>{
const img=canvas.toDataURL("image/png");
const {jsPDF}=window.jspdf;
let pdf=new jsPDF("p","mm","a4");
let width=210;
let height=canvas.height*width/canvas.width;
pdf.addImage(img,"PNG",0,0,width,height);
pdf.save("Mortality-Dashboard.pdf");
});
}

</script>

</body>
</html>
